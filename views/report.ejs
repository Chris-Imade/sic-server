<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Report Dashboard</title>
    <style>
      :root {
        --primary-color: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary-color: #64748b;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --background-light: #f8fafc;
        --background-white: #ffffff;
        --text-dark: #1e293b;
        --text-medium: #475569;
        --text-light: #64748b;
        --border-light: #e2e8f0;
        --border-medium: #cbd5e1;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
        --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        line-height: 1.6;
        color: var(--text-dark);
        background: var(--background-light);
        overflow-x: hidden;
      }

      .header {
        background: var(--gradient-bg);
        padding: 2rem 0;
        text-align: center;
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 1.5rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: #ffffff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-light);
        transition: all 0.3s ease;
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        line-height: 1;
        margin-bottom: 0.5rem;
      }

      .stat-label {
        font-size: 0.875rem;
        color: var(--text-medium);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 500;
      }

      .table-container {
        background: #ffffff;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        overflow: hidden;
        border: 1px solid var(--border-light);
      }

      .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem 2rem;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-bottom: 1px solid var(--border-light);
      }

      .table-header h2 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-dark);
        margin: 0;
      }

      .download-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.3s ease;
      }

      .download-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
      }

      th {
        padding: 1rem 1.5rem;
        text-align: left;
        font-weight: 600;
        color: var(--text-dark);
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        border-bottom: 2px solid var(--border-medium);
      }

      td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-light);
        color: var(--text-medium);
      }

      tbody tr:hover {
        background: #f8fafc;
      }

      .pagination-container {
        padding: 1.5rem 2rem;
        border-top: 1px solid var(--border-light);
        background: #f8fafc;
      }

      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 2rem 0;
        gap: 0.25rem;
        flex-wrap: wrap;
      }

      .pagination a,
      .pagination span {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 2.5rem;
        height: 2.5rem;
        padding: 0 0.5rem;
        margin: 0 0.125rem;
        border: 1px solid var(--border-medium);
        border-radius: 6px;
        text-decoration: none;
        color: var(--text-medium);
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .pagination a:not(.disabled):hover {
        background-color: var(--background-light);
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      .pagination .current {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        font-weight: 600;
      }

      .pagination .ellipsis {
        border: none;
        pointer-events: none;
        padding: 0 0.25rem;
      }

      .pagination .disabled {
        color: var(--text-light);
        pointer-events: none;
        opacity: 0.6;
      }

      .pagination a[rel="prev"],
      .pagination a[rel="next"] {
        padding: 0 1rem;
      }

      .pagination .current {
        background: var(--primary-color);
        color: white;
      }

      @media (max-width: 768px) {
        .container {
          padding: 0 1rem;
        }

        .stats-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .table-header {
          flex-direction: column;
          gap: 1rem;
          align-items: stretch;
          padding: 1rem;
        }

        .download-btn {
          width: 100%;
          justify-content: center;
        }
      }

      .pagination a,
      .pagination span {
        min-width: 2.2rem;
        height: 2.2rem;
        margin: 0 0.2rem;
        border-radius: 50%;
        font-size: 0.85rem;
      }

      .pagination .ellipsis {
        background: none;
        border: none;
        color: var(--text-light);
        font-weight: bold;
      }

      .pagination .current {
        background: var(--primary-color);
        color: #fff;
        border-color: var(--primary-color);
        font-weight: 600;
      }
    </style>
  </head>

  <body>
    <div class="header">
      <div class="container">
        <h1>ðŸ“Š Report Dashboard</h1>
      </div>
    </div>

    <div class="container">
      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number"><%= eventRegistrations.totalItems %></div>
          <div class="stat-label">Event Registrations</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= contacts.totalItems %></div>
          <div class="stat-label">Contacts</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= newsletters.totalItems %></div>
          <div class="stat-label">Newsletter Subscribers</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">
            <%= eventRegistrations.totalItems + contacts.totalItems +
            newsletters.totalItems %>
          </div>
          <div class="stat-label">Total Records</div>
        </div>
      </div>

      <!-- Event Registrations -->
      <div class="table-container">
        <div class="table-header">
          <h2>Event Registrations (<%= eventRegistrations.totalItems %>)</h2>
          <a href="/report/download/eventRegistration" class="download-btn"
            >â¬‡ Download CSV</a
          >
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% eventRegistrations.records.forEach(function(record) { %>
              <tr>
                <td><%= record._id %></td>
                <td><%= record.firstName %> <%= record.lastName %></td>
                <td><%= record.email %></td>
                <td><%= new Date(record.createdAt).toLocaleDateString() %></td>
                <td style="color: var(--success-color); font-weight: 500">
                  âœ“ Confirmed
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <% if (eventRegistrations.totalPages> 1) { %>
      <div class="pagination">
        <!-- Prev -->
        <% if (eventRegistrations.currentPage> 1) { %>
        <a
          href="?page=<%= eventRegistrations.currentPage - 1 %>"
          style="width: 35.19px; height: 35.19px"
          rel="prev"
          >&larr;</a
        >
        <% } else { %>
        <span class="disabled">&larr;</span>
        <% } %>

        <!-- First Page -->
        <% if (eventRegistrations.currentPage> 3) { %>
        <a href="?page=1">1</a>
        <span class="ellipsis">â€¦</span>
        <% } %>

        <!-- Page Numbers Around Current -->
        <% for (var i=Math.max(1, eventRegistrations.currentPage - 2); i
        <=Math.min(eventRegistrations.totalPages, eventRegistrations.currentPage
        + 2); i++) { %>
        <a
          href="?page=<%= i %>"
          class="<%= eventRegistrations.currentPage === i ? 'current' : '' %>"
        >
          <%= i %>
        </a>
        <% } %>

        <!-- Last Page -->
        <% if (eventRegistrations.currentPage < eventRegistrations.totalPages -
        2) { %>
        <span class="ellipsis">â€¦</span>
        <a href="?page=<%= eventRegistrations.totalPages %>">
          <%= eventRegistrations.totalPages %>
        </a>
        <% } %>

        <!-- Next -->
        <% if (eventRegistrations.currentPage < eventRegistrations.totalPages) {
        %>
        <a
          href="?page=<%= eventRegistrations.currentPage + 1 %>"
          style="width: 35.19px; height: 35.19px"
          rel="next"
          >&rarr;</a
        >
        <% } else { %>
        <span class="disabled">&rarr;</span>
        <% } %>
      </div>
      <% } %>

      <!-- Contacts -->
      <div class="table-container">
        <div class="table-header">
          <h2>Contacts (<%= contacts.totalItems %>)</h2>
          <% if (contacts.totalItems> 0) { %>
          <a href="/report/download/contact" class="download-btn"
            >â¬‡ Download CSV</a
          >
          <% } %>
        </div>
        <% if (contacts.totalItems===0) { %>
        <div class="no-records">No contacts found</div>
        <% } else { %>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Subject</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              <% contacts.records.forEach(function(record) { %>
              <tr>
                <td><%= record._id %></td>
                <td><%= record.name %></td>
                <td><%= record.email %></td>
                <td><%= record.subject %></td>
                <td><%= new Date(record.createdAt).toLocaleDateString() %></td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
        <% } %>
      </div>

      <!-- Newsletters -->
      <div class="table-container">
        <div class="table-header">
          <h2>Newsletter Subscriptions (<%= newsletters.totalItems %>)</h2>
          <% if (newsletters.totalItems> 0) { %>
          <a href="/report/download/newsletter" class="download-btn"
            >â¬‡ Download CSV</a
          >
          <% } %>
        </div>
        <% if (newsletters.totalItems===0) { %>
        <div class="no-records">No newsletter subscriptions found</div>
        <% } else { %>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Email</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% newsletters.records.forEach(function(record) { %>
              <tr>
                <td><%= record._id %></td>
                <td><%= record.email %></td>
                <td><%= new Date(record.createdAt).toLocaleDateString() %></td>
                <td style="color: var(--success-color); font-weight: 500">
                  âœ“ Subscribed
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
        <% } %>
      </div>
    </div>

    <% if (typeof error !=='undefined' ) { %>
    <div
      style="
        background: #ffebee;
        color: #d32f2f;
        padding: 1rem;
        margin: 1rem 0;
        border-left: 4px solid #f44336;
        border-radius: 4px;
      "
    >
      <strong>Error:</strong>
      <%= error %>
    </div>
    <% } %>
  </body>
</html>
